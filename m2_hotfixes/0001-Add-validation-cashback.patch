From 3c29457fb07a77ef50e31477f64c6e31815b11e5 Mon Sep 17 00:00:00 2001
From: root <root@mgt-development-environment-74>
Date: Mon, 21 Dec 2020 07:10:16 +0000
Subject: [PATCH] Add validation cashback

---
 app/code/Icube/Cashback/Observer/SalesOrder.php | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/app/code/Icube/Cashback/Observer/SalesOrder.php b/app/code/Icube/Cashback/Observer/SalesOrder.php
index 60f518785..c543c6597 100644
--- a/app/code/Icube/Cashback/Observer/SalesOrder.php
+++ b/app/code/Icube/Cashback/Observer/SalesOrder.php
@@ -28,6 +28,7 @@ class SalesOrder implements ObserverInterface
             return;
         }
 
+
         $appliedRuleIds = $order->getAppliedRuleIds();
         $subtotal = $order->getBaseSubtotal();
         $shippingAmount = $order->getBaseShippingAmount();
@@ -38,6 +39,11 @@ class SalesOrder implements ObserverInterface
             return;
         }
 
+        $cashbackList = $this->cashbackFactory->create()->getCollection()->addFieldToFilter('order_id',array('eq'=>$order->getId()));
+        if(!empty($cashbackList->getData())){
+            return;
+        }
+
         $promo_names = [];
         foreach ($getCashback['data'] as $promo) {
             array_push($promo_names, $promo['promo_name']);
-- 
2.20.1

